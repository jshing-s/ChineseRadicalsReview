<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mandarin Radicals Flashcards</title>
  <style>
    :root{
      --bg: #0f172a;
      --panel: #111827;
      --card: #0b1221;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #38bdf8;
      --accent-2: #22d3ee;
      --good: #22c55e;
      --bad: #ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 10% -10%, #1f2937, var(--bg));
      color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{ width: min(980px, 100%); }
    header{ display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px; }
    .title{ font-size: clamp(20px, 3vw, 28px); font-weight: 700; letter-spacing:.3px }
    .controls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }
    button, .chip, select{
      background: linear-gradient(180deg, #0f1b2e, #0a1220);
      color: var(--text);
      border:1px solid #1f2a44; border-radius: 14px; padding:10px 14px; cursor:pointer;
      font-weight:600; letter-spacing:.2px; transition: transform .04s ease, border-color .2s ease, background .2s ease;
    }
    button:hover, .chip:hover, select:hover{ border-color:#29426b }
    button:active{ transform: translateY(1px) }
    .chip.active{ outline: 2px solid var(--accent); }
    .muted{ color: var(--muted); font-weight:500 }
    .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }

    .progress{ height:8px; background:#0b1221; border:1px solid #13203a; border-radius:999px; overflow:hidden; margin:12px 0 20px }
    .bar{ height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width .35s ease }

    .stage{ display:grid; grid-template-columns: 1fr; gap:18px; }
    .card-wrap{ perspective:1200px; }
    .card{
      position:relative; height: min(58vh, 520px); min-height: 320px;
      border-radius: 20px; overflow:hidden; border:1px solid #1e293b;
      background: radial-gradient(800px 600px at 80% -10%, #0f1b2e, var(--card));
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .inner{ position:absolute; inset:0; transform-style:preserve-3d; transition: transform .55s cubic-bezier(.2,.7,.1,1); }
    .card.flipped .inner{ transform: rotateY(180deg); }

    .face{ position:absolute; inset:0; padding:24px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px; backface-visibility:hidden; }
    .front .hint{ font-size:14px; color:var(--muted); letter-spacing:.25px }
    .chars{ font-size: clamp(56px, 12vw, 140px); line-height:1; text-align:center }
    .pinyin{ font-size: clamp(18px, 3.2vw, 26px); color:#c7e7ff; letter-spacing:.4px }

    .back{ transform: rotateY(180deg); text-align:center; gap:16px }
    .meaning{ font-size: clamp(24px, 4.5vw, 36px); font-weight:800; letter-spacing:.5px }
    .sub{ font-size: 15px; color: var(--muted) }

    .actions{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center; margin-top: 14px }
    .good{ border-color: #164e2f; background: linear-gradient(180deg, #0e1c14, #0a1610); }
    .bad{ border-color:#4c1716; background: linear-gradient(180deg, #221010, #170c0c); }

    .stats{ display:flex; gap:16px; align-items:center; justify-content:space-between; margin-top:10px; color:var(--muted) }
    .pill{ padding:6px 10px; border-radius:999px; border:1px solid #1f2a44 }
    .k{ opacity:.75; font-size:12px }

    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:12px; border:1px solid #2a3552; padding:2px 6px; border-radius:6px; background:#0c1221 }
    .help{ max-width: 100%; border:1px dashed #1f2a44; padding:10px 12px; border-radius:12px; color:var(--muted); }

    .missed-list{ margin-top:20px; padding:12px; border:1px solid #2a3552; border-radius:12px; background:#0b1221; }
    .missed-list h3{ margin:0 0 10px; font-size:18px; color:var(--accent); }
    .missed-item{ margin-bottom:6px; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">Mandarin Radicals — Flashcards</div>
      <div class="controls">
        <button id="shuffleBtn" class="chip active" title="Shuffle order">Shuffle</button>
        <button id="reviewAll" class="chip active" title="Review: All">All</button>
        <button id="reviewMissed" class="chip" title="Review only missed">Missed</button>
        <select id="fontSize">
          <option value="1">Font: Default</option>
          <option value="1.15">Font: +15%</option>
          <option value="1.3">Font: +30%</option>
        </select>
        <button id="resetBtn" title="Reset progress">Reset</button>
      </div>
    </header>

    <div class="progress" aria-label="progress"><div id="bar" class="bar"></div></div>

    <section class="stage">
      <div id="card" class="card" role="button" aria-label="Flashcard (click to flip)">
        <div class="inner">
          <div class="face front">
            <div class="hint">Characters + Pinyin (front)</div>
            <div id="chars" class="chars">人 亻</div>
            <div id="pinyin" class="pinyin">rén</div>
          </div>
          <div class="face back">
            <div class="hint">Meaning (back)</div>
            <div id="meaning" class="meaning">person; man</div>
            <div id="sub" class="sub"></div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="flip">Flip <span class="k">(space)</span></button>
        <button id="know" class="good">I knew this <span class="k">(1)</span></button>
        <button id="dont" class="bad">I forgot <span class="k">(2)</span></button>
        <button id="next">Next <span class="k">(→)</span></button>
      </div>

      <div class="stats">
        <div><span id="progressText">1 / 18</span> • <span id="modeLabel">All</span></div>
        <div class="row">
          <div class="pill">Correct: <span id="correctTotal">0</span></div>
          <div class="pill">Missed: <span id="missedTotal">0</span></div>
          <div class="pill">Seen: <span id="seenTotal">0</span></div>
        </div>
      </div>

      <div class="help">
        Shortcuts — <span class="kbd">space</span> flip, <span class="kbd">→</span> next, <span class="kbd">1</span> knew, <span class="kbd">2</span> forgot. Click the card to flip. Front shows <b>pinyin + characters together</b>; back shows the English meaning.
      </div>

      <div class="missed-list" id="missedList" style="display:none">
        <h3>Missed Radicals</h3>
        <div id="missedItems"></div>
      </div>
    </section>
  </div>

  <script>
    // --- Data ---
    const RADICALS = [
      { key:'person',    chars:'人 亻', pinyin:'rén',  meaning:'person; man' },
      { key:'ice',       chars:'冫',   pinyin:'bīng', meaning:'ice; cold' },
      { key:'knife',     chars:'刀 刂', pinyin:'dāo',  meaning:'knife; blade' },
      { key:'speech',    chars:'言',   pinyin:'yán',  meaning:'speech; words' },
      { key:'mouth',     chars:'口',   pinyin:'kǒu',  meaning:'mouth; opening' },
      { key:'enclosure', chars:'囗',   pinyin:'wéi',  meaning:'enclosure' },
      { key:'earth',     chars:'土',   pinyin:'tǔ',   meaning:'earth; soil' },
      { key:'woman',     chars:'女',   pinyin:'nǚ',   meaning:'woman; female' },
      { key:'child',     chars:'子',   pinyin:'zǐ',   meaning:'child; son' },
      { key:'mountain',  chars:'山',   pinyin:'shān', meaning:'mountain' },
      { key:'roof',      chars:'宀',   pinyin:'mián', meaning:'roof' },
      { key:'heart',     chars:'心 忄', pinyin:'xīn',  meaning:'heart; mind' },
      { key:'hand',      chars:'手 扌', pinyin:'shǒu', meaning:'hand' },
      { key:'water',     chars:'水 氵', pinyin:'shuǐ', meaning:'water' },
      { key:'shell',     chars:'贝',   pinyin:'bèi',  meaning:'shell; money' },
      { key:'cart',      chars:'车',   pinyin:'chē',  meaning:'cart; vehicle' },
      { key:'sickness',  chars:'疒',   pinyin:'nè',   meaning:'sickness' },
      { key:'eye',       chars:'目',   pinyin:'mù',   meaning:'eye' },
    ];

    // --- State ---
    const state = {
      order: RADICALS.map((_, i) => i),
      i: 0,
      flipped: false,
      stats: RADICALS.map(() => ({ seen:0, correct:0, wrong:0 })),
      reviewMode: 'all',
      shuffle: true,
    };

    // --- Elements ---
    const cardEl = document.getElementById('card');
    const charsEl = document.getElementById('chars');
    const pinyinEl = document.getElementById('pinyin');
    const meaningEl = document.getElementById('meaning');
    const subEl = document.getElementById('sub');
    const barEl = document.getElementById('bar');
    const progressTextEl = document.getElementById('progressText');
    const modeLabelEl = document.getElementById('modeLabel');
    const correctTotalEl = document.getElementById('correctTotal');
    const missedTotalEl = document.getElementById('missedTotal');
    const seenTotalEl = document.getElementById('seenTotal');
    const missedListEl = document.getElementById('missedList');
    const missedItemsEl = document.getElementById('missedItems');

    const flipBtn = document.getElementById('flip');
    const nextBtn = document.getElementById('next');
    const knowBtn = document.getElementById('know');
    const dontBtn = document.getElementById('dont');

    const shuffleBtn = document.getElementById('shuffleBtn');
    const reviewAllBtn = document.getElementById('reviewAll');
    const reviewMissedBtn = document.getElementById('reviewMissed');
    const resetBtn = document.getElementById('resetBtn');
    const fontSizeSel = document.getElementById('fontSize');

    // --- Utils ---
    function shuffleArray(arr){
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function activeOrder(){
      if (state.reviewMode === 'missed'){
        const missed = state.order.filter(idx => state.stats[idx].wrong > 0);
        if (missed.length) return missed;
      }
      return state.order;
    }

    function clampIndex(){
      const ord = activeOrder();
      if (ord.length === 0){ state.i = 0; return; }
      if (state.i >= ord.length) state.i = 0;
      if (state.i < 0) state.i = ord.length - 1;
    }

    function setFlipped(v){
      state.flipped = v;
      cardEl.classList.toggle('flipped', v);
    }

    function updateMissedList(){
      const missedIndices = state.stats.map((s,i)=>s.wrong>0?i:null).filter(x=>x!==null);
      if (missedIndices.length){
        missedListEl.style.display='block';
        missedItemsEl.innerHTML = missedIndices.map(i => {
          const r = RADICALS[i];
          return `<div class="missed-item">${r.chars} (${r.pinyin}) — ${r.meaning}</div>`;
        }).join('');
      } else {
        missedListEl.style.display='none';
        missedItemsEl.innerHTML = '';
      }
    }

    function render(){
      const ord = activeOrder();
      clampIndex();
      const idx = ord[state.i] ?? 0;
      const item = RADICALS[idx];

      charsEl.textContent = item.chars;
      pinyinEl.textContent = item.pinyin;
      meaningEl.textContent = item.meaning;
      subEl.textContent = `Radical ${idx+1} of ${RADICALS.length}`;

      const pos = state.i + 1;
      progressTextEl.textContent = `${pos} / ${ord.length}`;
      modeLabelEl.textContent = state.reviewMode === 'missed' ? 'Missed' : 'All';
      barEl.style.width = `${(pos/ord.length)*100}%`;

      const totals = state.stats.reduce((acc, s) => {
        acc.seen += s.seen; acc.correct += s.correct; acc.wrong += s.wrong; return acc;
      }, {seen:0, correct:0, wrong:0});
      correctTotalEl.textContent = totals.correct;
      missedTotalEl.textContent = totals.wrong;
      seenTotalEl.textContent = totals.seen;

      document.documentElement.style.setProperty('--scale', fontSizeSel.value);
      charsEl.style.transform = `scale(${fontSizeSel.value})`;

      updateMissedList();
    }

    function next(){
      const ord = activeOrder();
      if (!ord.length) return;
      state.i = (state.i + 1) % ord.length;
      setFlipped(false);
      render();
    }

    function record(known){
      const ord = activeOrder();
      if (!ord.length) return;
      const idx = ord[state.i];
      const s = state.stats[idx];
      s.seen += 1;
      if (known) s.correct += 1; else s.wrong += 1;
      render(); // update missed list immediately
      next();
    }

    // --- Events ---
    cardEl.addEventListener('click', () => setFlipped(!state.flipped));
    flipBtn.addEventListener('click', () => setFlipped(!state.flipped));
    nextBtn.addEventListener('click', next);
    knowBtn.addEventListener('click', () => record(true));
    dontBtn.addEventListener('click', () => record(false));

    shuffleBtn.addEventListener('click', () => {
      state.shuffle = !state.shuffle;
      shuffleBtn.classList.toggle('active', state.shuffle);
      state.order = RADICALS.map((_, i) => i);
      if (state.shuffle) shuffleArray(state.order);
      state.i = 0; setFlipped(false); render();
    });

    reviewAllBtn.addEventListener('click', () => {
      state.reviewMode = 'all';
      reviewAllBtn.classList.add('active');
      reviewMissedBtn.classList.remove('active');
      state.i = 0; setFlipped(false); render();
    });

    reviewMissedBtn.addEventListener('click', () => {
      state.reviewMode = 'missed';
      reviewMissedBtn.classList.add('active');
      reviewAllBtn.classList.remove('active');
      state.i = 0; setFlipped(false); render();
    });

    resetBtn.addEventListener('click', () => {
      state.stats = RADICALS.map(() => ({ seen:0, correct:0, wrong:0 }));
      state.order = RADICALS.map((_, i) => i);
      if (state.shuffle) shuffleArray(state.order);
      state.i = 0; setFlipped(false); render();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === ' '){ e.preventDefault(); setFlipped(!state.flipped); }
      else if (e.key === 'ArrowRight'){ next(); }
      else if (e.key === '1'){ record(true); }
      else if (e.key === '2'){ record(false); }
    });

    fontSizeSel.addEventListener('change', render);

    // --- Init ---
    if (state.shuffle) shuffleArray(state.order);
    render();
  </script>
</body>
</html>
